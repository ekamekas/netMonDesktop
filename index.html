<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>customPRTGDesktop</title>
    <script type="application/javascript" src="app/js/utility.js">
    </script>
    <script type="text/javascript" src="app/js/dataStatistic.js">
    </script>
    <script type="text/javascript" src="app/js/plotly-latest.min.js">
    </script>
  </head>
  <body>
    Sensor:
    <input id="api_sensor" type="text" placeholder="API" value="11734"/><br>
    Interval:
    <input id="api_interval" type="text" placeholder="API" value=60 />
    (minutes)<br>
    <button id="api_button" type="button" name="button">Process</button>
    <br>
    <div id="graph_1" style="width:600px;height:250px;">
    </div>
    <div id="graph_2" style="width:600px;height:250px;">
    </div>
    <p id="result"></p>
    <script type="text/javascript">
      const HOST = "https://123.231.138.149/api/historicdata.xml?sdate=2017-06-01-00-00-00&edate=2017-06-30-00-00-00&"
      const USERNAME = "nsc_admin"
      const PASSHASH = "4041964660"

      var trafficData

      document.getElementById("api_button").onclick = function(){
        new Utility().getXML(HOST + "&id=" + document.getElementById("api_sensor").value.toString() + "&avg=" + (document.getElementById("api_interval").value * 60).toString() + "&username=" + USERNAME + "&passhash=" + PASSHASH, (result) => {
          if(result !== null){
            trafficData = []
            console.log(result)
            for(let i = 1; i < result.histdata.item.length; i++){
              trafficData.push(parseInt(result.histdata.item[i].value_raw[1]._/125))
            }
            let sortedTraffic = new DataStatistic().sortedData(trafficData.slice())
            let data_95e = new DataStatistic().percentil(95, sortedTraffic)
            // Plot data
            var layout = {
              title: 'Estimation peak bandwidth',
              yaxis: {
                title: 'Speed (Kbps)',
                titlefont: {
                  family: 'Courier New, monospace',
                  size: 18,
                  color: '#7f7f7f'
                }
              }
            };
            let data = {
              x: [],
              y: [],
              name: "data"
            };
            let estimasi = {
              x: [0, sortedTraffic.length],
              y: [data_95e, data_95e],
              name: "estimation"
            };
            for(let i = 1; i <= trafficData.length; i++){
              data.x.push(i)
            }
            data.y = trafficData
            Plotly.plot(document.getElementById('graph_1'), [data, estimasi], {
          	   margin: { t: 0 },
               title: "Bandwidth"
            })
            data.y = sortedTraffic
            Plotly.plot(document.getElementById('graph_2'), [data], {
          	   margin: { t: 0 },
               title: "Bandwidth"
            })
            document.getElementById("result").appendChild(document.createTextNode("Estimasi bandwidth peak : " + data_95e + " Kbps"))
          }
        })

      }
    </script>
  </body>
</html>
